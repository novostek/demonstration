!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).DiagramJSMinimap=e()}(this,(function(){"use strict";function t(t,e,i){return 2==arguments.length?t.getAttribute(e):null===i?t.removeAttribute(e):(t.setAttribute(e,i),t)}var e=[].indexOf,i=function(t,i){if(e)return t.indexOf(i);for(var n=0;n<t.length;++n)if(t[n]===i)return n;return-1},n=/\s+/,r=Object.prototype.toString;function o(t){return new a(t)}function a(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}a.prototype.add=function(t){if(this.list)return this.list.add(t),this;var e=this.array();return~i(e,t)||e.push(t),this.el.className=e.join(" "),this},a.prototype.remove=function(t){if("[object RegExp]"==r.call(t))return this.removeMatching(t);if(this.list)return this.list.remove(t),this;var e=this.array(),n=i(e,t);return~n&&e.splice(n,1),this.el.className=e.join(" "),this},a.prototype.removeMatching=function(t){for(var e=this.array(),i=0;i<e.length;i++)t.test(e[i])&&this.remove(e[i]);return this},a.prototype.toggle=function(t,e){return this.list?(void 0!==e?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this):(void 0!==e?e?this.add(t):this.remove(t):this.has(t)?this.remove(t):this.add(t),this)},a.prototype.array=function(){var t=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(n);return""===t[0]&&t.shift(),t},a.prototype.has=a.prototype.contains=function(t){return this.list?this.list.contains(t):!!~i(this.array(),t)};var s,l=window.addEventListener?"addEventListener":"attachEvent",h=window.removeEventListener?"removeEventListener":"detachEvent",c="addEventListener"!==l?"on":"",u={bind:function(t,e,i,n){return t[l](c+e,i,n||!1),i},unbind:function(t,e,i,n){return t[h](c+e,i,n||!1),i}};function d(t,e){return(e=e||document).querySelector(t)}function p(t,e){return function(t,e){e.appendChild(function(t,e){if(t.ownerDocument!==e.ownerDocument)try{return e.ownerDocument.importNode(t,!0)}catch(t){}return t}(t,e))}(e,t),t}"undefined"!=typeof document&&((s=document.createElement("div")).innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>',!s.getElementsByTagName("link").length,s=void 0);var g=2,f={"alignment-baseline":1,"baseline-shift":1,clip:1,"clip-path":1,"clip-rule":1,color:1,"color-interpolation":1,"color-interpolation-filters":1,"color-profile":1,"color-rendering":1,cursor:1,direction:1,display:1,"dominant-baseline":1,"enable-background":1,fill:1,"fill-opacity":1,"fill-rule":1,filter:1,"flood-color":1,"flood-opacity":1,font:1,"font-family":1,"font-size":g,"font-size-adjust":1,"font-stretch":1,"font-style":1,"font-variant":1,"font-weight":1,"glyph-orientation-horizontal":1,"glyph-orientation-vertical":1,"image-rendering":1,kerning:1,"letter-spacing":1,"lighting-color":1,marker:1,"marker-end":1,"marker-mid":1,"marker-start":1,mask:1,opacity:1,overflow:1,"pointer-events":1,"shape-rendering":1,"stop-color":1,"stop-opacity":1,stroke:1,"stroke-dasharray":1,"stroke-dashoffset":1,"stroke-linecap":1,"stroke-linejoin":1,"stroke-miterlimit":1,"stroke-opacity":1,"stroke-width":g,"text-anchor":1,"text-decoration":1,"text-rendering":1,"unicode-bidi":1,visibility:1,"word-spacing":1,"writing-mode":1};function v(t,e,i){var n=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=f[n];r?(r===g&&"number"==typeof i&&(i=String(i)+"px"),t.style[n]=i):t.setAttributeNS(null,e,i)}function m(t,e,i){if("string"==typeof e){if(void 0===i)return function(t,e){return f[e]?t.style[e]:t.getAttributeNS(null,e)}(t,e);v(t,e,i)}else!function(t,e){var i,n,r=Object.keys(e);for(i=0;n=r[i];i++)v(t,n,e[n])}(t,e);return t}function _(t,e){if(t.indexOf)return t.indexOf(e);for(var i=0;i<t.length;++i)if(t[i]===e)return i;return-1}var y=/\s+/,w=Object.prototype.toString;function x(t){return void 0!==t}function b(t){if(!t||!t.nodeType)throw new Error("A DOM element reference is required");this.el=t,this.list=t.classList}b.prototype.add=function(t){if(this.list)return this.list.add(t),this;var e=this.array();return~_(e,t)||e.push(t),x(this.el.className.baseVal)?this.el.className.baseVal=e.join(" "):this.el.className=e.join(" "),this},b.prototype.remove=function(t){if("[object RegExp]"===w.call(t))return this.removeMatching(t);if(this.list)return this.list.remove(t),this;var e=this.array(),i=_(e,t);return~i&&e.splice(i,1),this.el.className.baseVal=e.join(" "),this},b.prototype.removeMatching=function(t){for(var e=this.array(),i=0;i<e.length;i++)t.test(e[i])&&this.remove(e[i]);return this},b.prototype.toggle=function(t,e){return this.list?(x(e)?e!==this.list.toggle(t,e)&&this.list.toggle(t):this.list.toggle(t),this):(x(e)?e?this.add(t):this.remove(t):this.has(t)?this.remove(t):this.add(t),this)},b.prototype.array=function(){var t=(this.el.getAttribute("class")||"").replace(/^\s+|\s+$/g,"").split(y);return""===t[0]&&t.shift(),t},b.prototype.has=b.prototype.contains=function(t){return this.list?this.list.contains(t):!!~_(this.array(),t)};var C={svg:"http://www.w3.org/2000/svg"},R='<svg xmlns="'+C.svg+'"';function E(t){var e=!1;"<svg"===t.substring(0,4)?-1===t.indexOf(C.svg)&&(t=R+t.substring(4)):(t=R+">"+t+"</svg>",e=!0);var i=function(t){var e;return(e=new DOMParser).async=!1,e.parseFromString(t,"text/xml")}(t);if(!e)return i;for(var n=document.createDocumentFragment(),r=i.firstChild;r.firstChild;)n.appendChild(r.firstChild);return n}function D(t,e){var i;return"<"===t.charAt(0)?(i=E(t).firstChild,i=document.importNode(i,!0)):i=document.createElementNS(C.svg,t),e&&m(i,e),i}D("svg");var M=Object.prototype.toString,j=Object.prototype.hasOwnProperty;function S(t,e){return j.call(t,e)}function O(t,e){var i;if(void 0!==t){var n=function(t){return"[object Array]"===M.call(t)}(t)?B:k;for(var r in t)if(S(t,r)&&!1===e(i=t[r],n(r)))return i}}function N(t,e){return!!function(t,e,i){return O(t,(function(t,n){i=e(i,t,n)})),i}(t,(function(t,i,n){return t&&e(i,n)}),!0)}function k(t){return t}function B(t){return Number(t)}function V(){return(V=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function A(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return V.apply(void 0,[t].concat(i))}var P="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var z=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){var i;i=P,t.exports=function(t){if(t.CSS&&t.CSS.escape)return t.CSS.escape;var e=function(t){if(0==arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var e,i=String(t),n=i.length,r=-1,o="",a=i.charCodeAt(0);++r<n;)0!=(e=i.charCodeAt(r))?o+=e>=1&&e<=31||127==e||0==r&&e>=48&&e<=57||1==r&&e>=48&&e<=57&&45==a?"\\"+e.toString(16)+" ":0==r&&1==n&&45==e||!(e>=128||45==e||95==e||e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122)?"\\"+i.charAt(r):i.charAt(r):o+="ï¿½";return o};return t.CSS||(t.CSS={}),t.CSS.escape=e,e}(i)}));var Y={min:.2,max:4},X=10,L=.1,G=250;function T(t,e,i,n,r){var o=this;function a(t){o._state._svgClientRect&&!H(o._state._svgClientRect)||(o._state._svgClientRect=o._svg.getBoundingClientRect()),q(I({x:t.clientX-o._state._svgClientRect.left,y:t.clientY-o._state._svgClientRect.top},o._svg,o._lastViewbox),o._canvas),o._update()}function s(t){return function(e){o._state._svgClientRect&&!H(o._state._svgClientRect)||(o._state._svgClientRect=o._svg.getBoundingClientRect()),t&&a(e);var i=I({x:e.clientX-o._state._svgClientRect.left,y:e.clientY-o._state._svgClientRect.top},o._svg,o._lastViewbox),r=n.viewbox(),s=function(t,e){var i={x:e.x+e.width/2,y:e.y+e.height/2};return{x:t.x-i.x,y:t.y-i.y}}(i,r),c=o._viewportDom.getBoundingClientRect(),d={x:e.clientX-c.left+1,y:e.clientY-c.top+1};A(o._state,{cachedViewbox:r,initialDragPosition:{x:e.clientX,y:e.clientY},isDragging:!0,offsetViewport:s,offsetViewportDom:d,viewportClientRect:o._viewport.getBoundingClientRect(),parentClientRect:o._parent.getBoundingClientRect()}),u.bind(document,"mousemove",l),u.bind(document,"mouseup",h)}}function l(t){if(o._state.isDragging){o._state._svgClientRect&&!H(o._state._svgClientRect)||(o._state._svgClientRect=o._svg.getBoundingClientRect());var e=o._state.offsetViewportDom,i=o._state.viewportClientRect,n=o._state.parentClientRect;A(o._viewportDom.style,{top:t.clientY-e.y-n.top+"px",left:t.clientX-e.x-n.left+"px"});var r=K(n,{top:t.clientY-e.y-n.top,left:t.clientX-e.x-n.left,width:i.width,height:i.height});A(o._overlay.style,{clipPath:r});var a=I({x:t.clientX-o._state._svgClientRect.left,y:t.clientY-o._state._svgClientRect.top},o._svg,o._lastViewbox);q({x:a.x-o._state.offsetViewport.x,y:a.y-o._state.offsetViewport.y},o._canvas)}}function h(t){o._state.isDragging&&(o._state.initialDragPosition.x===t.clientX&&o._state.initialDragPosition.y===t.clientY&&a(t),o._update(),A(o._state,{cachedViewbox:null,initialDragPosition:null,isDragging:!1,offsetViewport:null,offsetViewportDom:null}),u.unbind(document,"mousemove",l),u.unbind(document,"mouseup",h))}this._canvas=n,this._elementRegistry=r,this._eventBus=i,this._injector=e,this._state={isOpen:void 0,isDragging:!1,initialDragPosition:null,offsetViewport:null,cachedViewbox:null,dragger:null,svgClientRect:null,parentClientRect:null,zoomDelta:0},this._init(),this.toggle(t&&t.open||!1),u.bind(this._svg,"click",(function(t){t.preventDefault(),t.stopPropagation(),a(t)})),u.bind(this._viewportDom,"mousedown",s(!1)),u.bind(this._svg,"mousedown",s(!0)),u.bind(this._parent,"wheel",(function(t){if(t.preventDefault(),t.stopPropagation(),t.ctrlKey&&(o._state._svgClientRect&&!H(o._state._svgClientRect)||(o._state._svgClientRect=o._svg.getBoundingClientRect()),e=t,i=o._state._svgClientRect,e.x>i.left&&e.x<i.left+i.width&&e.y>i.top&&e.y<i.top+i.height)){var e,i,r,a,s,l,h=0===t.deltaMode?.02:.32,c=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*J(t.deltaY)*-h;if(o._state.zoomDelta+=c,Math.abs(o._state.zoomDelta)>L){var u=c>0?1:-1,d=Math.log(n.zoom())/Math.log(10),p=(r=Y,a=2*X,s=Math.log(r.min)/Math.log(10),l=Math.log(r.max)/Math.log(10),(Math.abs(s)+Math.abs(l))/a),g=Math.round(d/p)*p;g+=p*u;var f=Math.pow(10,g);n.zoom(function(t,e){return Math.max(t.min,Math.min(t.max,e))}(Y,f),v),o._state.zoomDelta=0;var v=I({x:t.clientX-o._state._svgClientRect.left,y:t.clientY-o._state._svgClientRect.top},o._svg,o._lastViewbox);q(v,o._canvas),o._update()}}})),u.bind(this._toggle,"click",(function(t){t.preventDefault(),t.stopPropagation(),o.toggle()})),i.on(["shape.added","connection.added"],(function(t){var e=t.element;o._addElement(e),o._update()})),i.on(["shape.removed","connection.removed"],(function(t){var e=t.element;o._removeElement(e),o._update()})),i.on("elements.changed",G,(function(t){t.elements.forEach((function(t){o._updateElement(t)})),o._update()})),i.on("element.updateId",(function(t){var e=t.element,i=t.newId;o._updateElementId(e,i)})),i.on("canvas.viewbox.changed",(function(){o._state.isDragging||o._update()})),i.on("canvas.resized",(function(){document.body.contains(o._parent)&&(o._state.isDragging||o._update(),o._state._svgClientRect=o._svg.getBoundingClientRect())}))}function I(t,e,i){var n=e.getBoundingClientRect(),r=function(t,e){var i=t.width/t.height,n=A({},{x:t.x,y:t.y,width:t.width,height:t.height});if(i>e){var r=n.width*(1/e),o=n.y-(r-n.height)/2;A(n,{y:o,height:r})}else if(i<e){var a=n.height*e,s=n.x-(a-n.width)/2;A(n,{x:s,width:a})}return n}(i,n.width/n.height);return{x:$(t.x,0,n.width,r.x,r.x+r.width),y:$(t.y,0,n.height,r.y,r.y+r.height)}}function q(t,e){var i=e.viewbox(),n=i.width,r=i.height;e.viewbox({x:t.x-n/2,y:t.y-r/2,width:n,height:r})}function $(t,e,i,n,r){return(t-e)*(r-n)/(i-e)+n}function F(t,e,i){var n=[].slice.call(e.childNodes)[i];e.insertBefore(t,n.nextSibling)}function H(t){return 0===t.width&&0===t.height}T.$inject=["config.minimap","injector","eventBus","canvas","elementRegistry"],T.prototype._init=function(){var t=this._canvas.getContainer(),e=this._parent=document.createElement("div");o(e).add("djs-minimap"),t.appendChild(e);var i=this._toggle=document.createElement("div");o(i).add("toggle"),e.appendChild(i);var n=this._map=document.createElement("div");o(n).add("map"),e.appendChild(n);var r=this._svg=D("svg");m(r,{width:"100%",height:"100%"}),p(n,r),p(r,this._elementsGroup=D("g"));var a=this._viewportGroup=D("g");p(r,a);var s,l=this._viewport=D("rect");(s=l,new b(s)).add("viewport"),p(a,l),u.bind(e,"mousedown",(function(t){t.stopPropagation()}));var h=this._viewportDom=document.createElement("div");o(h).add("viewport-dom"),this._parent.appendChild(h);var c=this._overlay=document.createElement("div");o(c).add("overlay"),this._parent.appendChild(c)},T.prototype._update=function(){var t=this._canvas.viewbox(),e=t.inner,i=t.outer;if(function t(e){return N(e,(function(e){return i=e,"[object Object]"===M.call(i)?t(e):function(t){return"[object Number]"===M.call(t)}(e)&&isFinite(e);var i}))}(t)){var n,r,o,a,s=i.width-e.width,l=i.height-e.height;e.width<i.width?(n=e.x-s/2,o=i.width,e.x+e.width<i.width&&(n=Math.min(0,e.x))):(n=e.x,o=e.width),e.height<i.height?(r=e.y-l/2,a=i.height,e.y+e.height<i.height&&(r=Math.min(0,e.y))):(r=e.y,a=e.height),n-=50,r-=50,o+=100,a+=100,this._lastViewbox={x:n,y:r,width:o,height:a},m(this._svg,{viewBox:n+", "+r+", "+o+", "+a}),m(this._viewport,{x:t.x,y:t.y,width:t.width,height:t.height});var h=this._state._parentClientRect=this._parent.getBoundingClientRect(),c=this._viewport.getBoundingClientRect(),u={top:c.top-h.top,left:c.left-h.left,width:c.width,height:c.height};A(this._viewportDom.style,{top:u.top+"px",left:u.left+"px",width:u.width+"px",height:u.height+"px"});var d=K(h,u);A(this._overlay.style,{clipPath:d})}},T.prototype.open=function(){A(this._state,{isOpen:!0}),o(this._parent).add("open");var e=this._injector.get("translate",!1)||function(t){return t};t(this._toggle,"title",e("Close minimap")),this._update(),this._eventBus.fire("minimap.toggle",{open:!0})},T.prototype.close=function(){A(this._state,{isOpen:!1}),o(this._parent).remove("open");var e=this._injector.get("translate",!1)||function(t){return t};t(this._toggle,"title",e("Open minimap")),this._eventBus.fire("minimap.toggle",{open:!1})},T.prototype.toggle=function(t){var e=this.isOpen();void 0===t&&(t=!e),t!=e&&(t?this.open():this.close())},T.prototype.isOpen=function(){return this._state.isOpen},T.prototype._updateElement=function(t){try{void 0!==t.parent&&null!==t.parent&&(this._removeElement(t),this._addElement(t))}catch(t){console.warn("Minimap#_updateElement errored",t)}},T.prototype._updateElementId=function(t,e){try{var i=d("#"+z(t.id),this._elementsGroup);i&&(i.id=e)}catch(t){console.warn("Minimap#_updateElementId errored",t)}},T.prototype._addElement=function(t){var e,i,n,r=this;this._removeElement(t);var o=this._createElement(t),a=d("#"+z(t.parent.id),this._elementsGroup);if(o){var s=function(t,e){var i=d(".djs-children",e.parentNode);if(!i)return;var n=[].slice.call(i.childNodes),r=-1;return n.forEach((function(e,i){d(".djs-element",e)===t&&(r=i)})),r}(this._elementRegistry.getGraphics(t),this._elementRegistry.getGraphics(t.parent));return"undefined"!==s&&a?a.childNodes.length>s?F(o,a,s):F(o,a,a.childNodes.length-1):this._elementsGroup.appendChild(o),!function(t){return t.waypoints}(t)?(i=t.x,n=t.y,a&&(i-=(e=t.parent).x,n-=e.y),m(o,{transform:"translate("+i+" "+n+")"})):(i=0,n=0,void 0!==(e=t.parent).x&&void 0!==e.y&&(i=-e.x,n=-e.y),m(o,{transform:"translate("+i+" "+n+")"})),t.children&&t.children.length&&t.children.forEach((function(t){r._addElement(t)})),o}},T.prototype._removeElement=function(t){var e=this._svg.getElementById(t.id);e&&function(t){var e=t.parentNode;e&&e.removeChild(t)}(e)},T.prototype._createElement=function(t){var e,i=this._elementRegistry.getGraphics(t);if(i&&(e=function(t){return t.childNodes[0]}(i))){var n=function(t){return t.cloneNode(!0)}(e);return m(n,{id:t.id}),n}};var J=Math.sign||function(t){return t>=0?1:-1};function K(t,e){return"polygon("+[Z(e.left,e.top),Z(e.left+e.width,e.top),Z(e.left+e.width,e.top+e.height),Z(e.left,e.top+e.height),Z(e.left,t.height),Z(t.width,t.height),Z(t.width,0),Z(0,0),Z(0,t.height),Z(e.left,t.height)].join(", ")+")"}function Z(t,e){return t+"px "+e+"px"}return{__init__:["minimap"],minimap:["type",T]}}));
